// packages/@rummikub/ui/src/components/game/Tile/Tile.tsx
import { forwardRef, useMemo } from 'react';
import { useAccessibility } from '../../../hooks/useAccessibility';

interface TileProps {
  color: 'red' | 'blue' | 'black' | 'yellow';
  value: number;
  isJoker?: boolean;
  isSelected?: boolean;
  onSelect?: () => void;
}

export const Tile = forwardRef<HTMLButtonElement, TileProps>(
  ({ color, value, isJoker, isSelected, onSelect }, ref) => {
    const { colorBlindMode, highContrastMode, reducedMotion } = useAccessibility();

    // Patterns for colorblind mode
    const colorPattern = useMemo(() => {
      if (!colorBlindMode) return null;
      
      const patterns = {
        red: '●',      // Circle
        blue: '■',     // Square
        black: '▲',    // Triangle
        yellow: '◆',   // Diamond
      };
      
      return patterns[color];
    }, [color, colorBlindMode]);

    const ariaLabel = useMemo(() => {
      if (isJoker) return 'Joker tile';
      return `${color} ${value}`;
    }, [color, value, isJoker]);

    return (
      <button
        ref={ref}
        role="button"
        aria-label={ariaLabel}
        aria-pressed={isSelected}
        className={clsx(
          'tile',
          `tile--${color}`,
          isSelected && 'tile--selected',
          highContrastMode && 'tile--high-contrast',
          reducedMotion && 'tile--no-animation'
        )}
        onClick={onSelect}
        onKeyDown={(e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            onSelect?.();
          }
        }}
        tabIndex={0}
      >
        <span className="tile__value">
          {isJoker ? '★' : value}
        </span>
        
        {colorBlindMode && (
          <span className="tile__pattern" aria-hidden="true">
            {colorPattern}
          </span>
        )}
      </button>
    );
  }
);